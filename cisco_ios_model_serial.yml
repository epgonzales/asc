---
- name: Get Cisco IOS device facts
  hosts: all
  gather_facts: no
  connection: network_cli

  vars:
    ansible_network_os: ios
    device_type: cisco_ios
    export_path: "/home/semaphore"
    
  tasks:
    - name: Collect IOS facts
      cisco.ios.ios_facts:
        gather_subset:
          - all
      register: device_info

    - name: Display model and serial number
      debug:
        msg: |
          Device: {{ inventory_hostname }}
          Model: {{ device_info.ansible_facts.ansible_net_model }}
          Software: {{ device_info.ansible_facts.ansible_net_version }}
          Serial Number: {{ device_info.ansible_facts.ansible_net_serialnum }}

    - name: Create summary report
      template:
        dest: "{{ export_path }}/inventory_summary.txt"
        mode: '0644'
        content: |
          Cisco Device Inventory Report
          ============================
          Generated on: {{ ansible_date_time.iso8601 }}
          
          {% for host in groups['all'] %}
          Device: {{ host }}
          Model: {{ hostvars[host]['device_info']['ansible_facts']['ansible_net_model'] | default('N/A') }}
          Software: {{ hostvars[host]['device_info']['ansible_facts']['ansible_net_version'] | default('N/A') }}
          Serial: {{ hostvars[host]['device_info']['ansible_facts']['ansible_net_serialnum'] | default('N/A') }}
          ---
          {% endfor %}
      delegate_to: localhost
      run_once: true
